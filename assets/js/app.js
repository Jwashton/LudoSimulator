$(function(){var t,i,e,n,r,s,o,l,h,u,a,c,d;return t=function(){function t(t,i,e){var n;this.players=t,this.die=i,this.context=e,this.currentPlayer=3,this.again=!1,this.track=function(){var t,i;for(i=[],n=t=0;51>=t;n=++t)i.push(null);return i}(),this.doors=[50,24,11,37],this.starts=[0,26,13,39],this.houses=[[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null],[null,null,null,null,null]],this.reserves=[4,4,4,4],this.goals=[0,0,0,0],this.colors=["#FF0000","#00FF00","#00AAFF","#FFFF00"]}return t.prototype.drawCircle=function(t,i,e,n){return this.context.fillStyle=n,this.context.beginPath(),this.context.arc(t,i,e,0,2*Math.PI),this.context.fill()},t.prototype.draw=function(){var t,i,e,n,r,s,l,h,u,a,c,d,f,w,p,g,y,v,F,x,k,m,P,S,H,C;for(o.font="12pt serif",o.fillStyle="#FFFFFF",o.fillRect(0,0,window.innerWidth,window.innerHeight),e=r=0;51>=r;e=++r)this.drawCircle(25*e+20,20,10,"#000000");for(v=this.starts,n=s=0,l=v.length;l>s;n=++s)e=v[n],this.drawCircle(25*e+20,40,10,this.colors[n]),o.fillStyle="#000000",o.fillText(this.reserves[n],25*e+16,45);for(F=this.doors,y=f=0,h=F.length;h>f;y=++f){for(d=F[y],x=this.houses[y],n=w=0,u=x.length;u>w;n=++w)e=x[n],this.drawCircle(25*d+20,20*n+40,10,this.colors[y]),t=null!=e?this.colors[e]:"#FFFFFF",this.drawCircle(25*d+20,20*n+40,8,t);4===this.goals[y]?(o.fillStyle=this.colors[y],o.fillRect(25*d,140,40,30)):(o.strokeStyle=this.colors[y],o.strokeRect(25*d,140,40,30)),o.fillStyle="#000000",o.fillText(this.goals[y],25*d+16,160)}for(k=this.track,n=p=0,a=k.length;a>p;n=++p)e=k[n],null!=e&&(t=this.colors[e],this.drawCircle(25*n+20,20,8,t));for(i=this.colors[this.currentPlayer],this.drawCircle(34,window.innerHeight-35,10,i),P=this.die.history.splice(-1),o.fillStyle="#000000",C=window.innerHeight-30,o.fillText(P,30,C),o.fillText("Space to move, p to toggle play",60,C),S=["Find all current active pieces","Expose Decision Points","Create Strategies","Highlight last move (arrows maybe?)"],H=window.innerWidth-400,C=window.innerHeight-(60+20*S.length),o.fillText("Todo List:",H-20,C),m=[],n=g=0,c=S.length;c>g;n=++g)e=S[n],C=window.innerHeight-(40+20*S.length)+20*n,m.push(o.fillText(e,H,C));return m},t.prototype.checkEnd=function(){return-1!==this.goals.indexOf(4)},t.prototype.move=function(){return this.again||(this.currentPlayer=(this.currentPlayer+1)%4),this.again=!1,this.players[this.currentPlayer].move(this),this.draw()},t.prototype.goAgain=function(){return this.again=!0},t.prototype.returnPiece=function(t){var i;return i=this.track[t],this.reserves[i]++,this.track[t]=null},t.prototype.deliverPiece=function(t){return this.goals[t]++},t}(),i=function(){function t(t){this.numSides=t,this.history=[]}return t.prototype.roll=function(){var t;return t=Math.floor(Math.random()*this.numSides)+1,this.history.push(t),t},t.prototype.recentRolls=function(){return this.history.slice(-20,-1)},t}(),e=function(){function t(t,i){this.id=t,this.name=i}return t.prototype.hasStart=function(t){return t.reserves[this.id]>0},t.prototype.hasExposed=function(t){return-1!==t.track.indexOf(this.id)},t.prototype.hasHoused=function(t){return-1!==t.houses[this.id].indexOf(this.id)},t.prototype.start=function(t){return this.hasStart(t)?(t.reserves[this.id]-=1,null!=t.track[t.starts[this.id]]&&t.returnPiece(t.starts[this.id]),t.track[t.starts[this.id]]=this.id):void 0},t.prototype.advance=function(t,i,e,n){var r,s,o;if(r=i+e,n&&(console.log("Moving from "+i+" to "+r+" in house!"),5===r?(t.deliverPiece(this.id),t.houses[this.id][i]=null):5>r&&null==t.houses[this.id][r]&&(t.houses[this.id][i]=null,t.houses[this.id][r]=this.id)),t.track[i]===this.id)if(s=t.doors[this.id],i===s||s>i&&i+e>s){if(o=e-(s-i)-1,null==t.houses[this.id][o])return t.track[i]=null,t.houses[this.id][o]=this.id}else if(r=(i+e)%52,t.track[r]!==this.id)return null!=t.track[r]&&t.returnPiece(r),t.track[i]=null,t.track[r]=this.id},t.prototype.move=function(t){var i,e;return e=t.die.roll(),console.log("rolled a "+e),6===e?(this.start(t),t.goAgain()):this.hasExposed(t)?(i=t.track.indexOf(this.id),this.advance(t,i,e,!1)):this.hasHoused(t)?(i=t.houses[this.id].indexOf(this.id),this.advance(t,i,e,!0)):console.log("Do Nothing")},t}(),s=document.getElementById("board"),o=s.getContext("2d"),h=new e(0,"Fred"),u=new e(1,"Fred"),a=new e(2,"Fred"),c=new e(3,"Fred"),l=new i(6),r=new t([h,u,a,c],l,o),n=null,d=function(){return s.width=window.innerWidth,s.height=window.innerHeight,r.draw()},window.addEventListener("resize",d,!1),d(),window.move=function(){return r.move(),r.checkEnd()?(window.clearInterval(n),n=null):void 0},window.displayHouses=function(){return console.log(r.houses)},$(window).on("keyup",function(t){return 32===t.which?window.move():80===t.which?(console.log("p pressed"),null==n?n=window.setInterval(move,100):(window.clearInterval(n),n=null)):void 0})});